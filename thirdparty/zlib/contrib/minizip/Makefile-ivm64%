CC=ivm64-gcc

ZLIB_SRCDIR=../..

# ivm64: __APPLE__ forces to use open() instead of open64()
#CFLAGS := $(CFLAGS) -O2 -I../.. -D__APPLE__
CFLAGS := $(CFLAGS) -O2 -I../..

UNZ_OBJS = miniunz.o unzip.o ioapi.o $(ZLIB_SRCDIR)/libz.a
ZIP_OBJS = minizip.o zip.o   ioapi.o $(ZLIB_SRCDIR)/libz.a

.c.o:
	$(CC) -c $(CFLAGS) $*.c

all: miniunz minizip libminizip.a

miniunz:  $(UNZ_OBJS)
	$(CC) $(CFLAGS) -o $@ $(UNZ_OBJS)

minizip:  $(ZIP_OBJS)
	$(CC) $(CFLAGS) -o $@ $(ZIP_OBJS)

libminizip.a: miniunz.o unzip.o ioapi.o ida_miniunz.o
	ar -r libminizip.a  *.o

test:	miniunz minizip
	@rm -f test.*
	@echo hello hello hello > test.txt
	./minizip test test.txt
	./miniunz -l test.zip
	@mv test.txt test.old
	./miniunz test.zip
	@cmp test.txt test.old
	@rm -f test.*

clean:
	/bin/rm -f *.o *~ minizip miniunz test.* mini*z*.b mini*z*.sym libminizip.a
